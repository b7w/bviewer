{% extends 'core/base.html' %}
{% load staticfiles %}

{% block title %}{{ main.title }}{% endblock %}

{% block navigation %}
    <li><a href="{% url 'archive.archive' main.id %}" title="Download all images in archive">Download</a></li>
{% endblock %}

{% block main %}
    <div class="album-title">
        <h2>{{ main.title }}</h2>

        <p>{{ main.description|linebreaksbr }}</p>
    </div>

    <ul class="album">
        {% for item in videos %}
            <li class="preview" data-ref-touch="{% url 'core.video' item.id %}">
                <div class="preview-body">
                    <a href="{{ item.url }}" rel="shadowbox[videos];width=960;height=540;title={{ item.title }}">
                        <img src="{% url 'core.video.thumbnail' item.id %}">
                    </a>

                    <div class="video-tag">
                        <img src="{% static 'core/img/video.png' %}" alt="">
                    </div>

                    <div class="caption">
                        <a href="{% url 'core.video' item.id %}">
                            <i class="icon-white icon-zoom-in"></i>
                        </a>
                    </div>
                </div>
            </li>
        {% endfor %}
        {% for item in images %}
            <li class="preview" data-ref-touch="{% url 'core.image' item.id %}">
                <div class="preview-body">
                    <a href="{% url 'core.download' 'big' item.id %}" rel="shadowbox[images]">
                        <img src="{% url 'core.download' 'small' item.id %}">
                    </a>

                    <div class="caption">
                        <a href="{% url 'core.image' item.id %}">
                            <i class="icon-white icon-zoom-in"></i>
                        </a>
                    </div>
                </div>
            </li>
        {% endfor %}
    </ul>

{% endblock %}

{% block media %}
    {{ block.super }}
    <link id="shadowbox.css" href="{% static 'core/css/shadowbox.css' %}" rel="stylesheet" type="text/css">
    <script id="shadowbox.js" src="{% static 'core/js/shadowbox.js' %}" type="text/javascript"></script>
    <script type="text/javascript">
        //jQuery('.span12 h2').html(navigator.userAgent);
        function full_support() {
            var touch = 'ontouchstart' in document.documentElement;
            var agent = navigator.userAgent.toLowerCase();
            if (!touch) {
            } else {
                if (agent.indexOf('crmo') != -1)
                    return false;
                else if (agent.indexOf('android 4') != -1)
                    return true;
                else if (agent.indexOf('ipad') != -1)
                    return true;
                else
                    return false;
            }
            return true;
        }

        if (full_support()) {
            Shadowbox.init({
                "overlayOpacity": 0.95,
                "slideshowDelay": 3,
                "viewportPadding": 12,
                onOpen: function (currentImage) {
                    Shadowbox.play();
                    Shadowbox.pause();
                }
            });
        } else {
            jQuery('.thumbnails a').bind('click', function (e) {
                e.preventDefault();
                window.location = jQuery(this).parent().attr('data-ref-touch');
            });
        }

        function load_next() {
            var image = jQuery('.thumbnails .hidden:first');
            if (image.size() != 0) {
                var link = jQuery(image).attr('src');
                jQuery(image).attr('src', link.substring(1));
                jQuery(image).removeClass('hidden');
            }
        }

        jQuery('.thumbnails .hidden').bind('load', function () {
            jQuery(this).fadeIn('slow');
            load_next();
        });

        jQuery('.thumbnails .hidden').bind('error', function () {
            var it = jQuery(this);
            if (!( it.attr('src').indexOf('#') == 0)) {
                var a = it.parent();
                a.attr('href', '#404');
                a.attr('rel', '');
                var li = a.parent();
                li.attr('data-ref-touch', '');
                li.children('.caption').html('<div style="color:#555;font-size: 12px;">Image not found</dim>');
                it.attr('src', '{% static "core/img/gallery.png" %}');
                it.css('opacity', '0.5');
            }
        });

        jQuery('#sb-body').live('click', function (e) {
            var width = jQuery(this).width() / 3;
            var x = e.pageX - jQuery(this).offset().left;
            if (x < width) {
                Shadowbox.previous()
            } else {
                Shadowbox.next();
            }
        });

        load_next();
        load_next();
        load_next();
    </script>
{% endblock %}